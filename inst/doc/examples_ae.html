<!DOCTYPE html>

<html>

<head>

<meta charset="utf-8" />
<meta name="generator" content="pandoc" />
<meta http-equiv="X-UA-Compatible" content="IE=EDGE" />

<meta name="viewport" content="width=device-width, initial-scale=1" />



<title>Examples: A&amp;E data</title>

<script>// Pandoc 2.9 adds attributes on both header and div. We remove the former (to
// be compatible with the behavior of Pandoc < 2.8).
document.addEventListener('DOMContentLoaded', function(e) {
  var hs = document.querySelectorAll("div.section[class*='level'] > :first-child");
  var i, h, a;
  for (i = 0; i < hs.length; i++) {
    h = hs[i];
    if (!/^h[1-6]$/i.test(h.tagName)) continue;  // it should be a header h1-h6
    a = h.attributes;
    while (a.length > 0) h.removeAttribute(a[0].name);
  }
});
</script>

<style type="text/css">
code{white-space: pre-wrap;}
span.smallcaps{font-variant: small-caps;}
span.underline{text-decoration: underline;}
div.column{display: inline-block; vertical-align: top; width: 50%;}
div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
ul.task-list{list-style: none;}
</style>



<style type="text/css">
code {
white-space: pre;
}
.sourceCode {
overflow: visible;
}
</style>
<style type="text/css" data-origin="pandoc">
pre > code.sourceCode { white-space: pre; position: relative; }
pre > code.sourceCode > span { line-height: 1.25; }
pre > code.sourceCode > span:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode > span { color: inherit; text-decoration: inherit; }
div.sourceCode { margin: 1em 0; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
pre > code.sourceCode { white-space: pre-wrap; }
pre > code.sourceCode > span { text-indent: -5em; padding-left: 5em; }
}
pre.numberSource code
{ counter-reset: source-line 0; }
pre.numberSource code > span
{ position: relative; left: -4em; counter-increment: source-line; }
pre.numberSource code > span > a:first-child::before
{ content: counter(source-line);
position: relative; left: -1em; text-align: right; vertical-align: baseline;
border: none; display: inline-block;
-webkit-touch-callout: none; -webkit-user-select: none;
-khtml-user-select: none; -moz-user-select: none;
-ms-user-select: none; user-select: none;
padding: 0 4px; width: 4em;
color: #aaaaaa;
}
pre.numberSource { margin-left: 3em; border-left: 1px solid #aaaaaa; padding-left: 4px; }
div.sourceCode
{ }
@media screen {
pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
}
code span.al { color: #ff0000; font-weight: bold; } 
code span.an { color: #60a0b0; font-weight: bold; font-style: italic; } 
code span.at { color: #7d9029; } 
code span.bn { color: #40a070; } 
code span.bu { color: #008000; } 
code span.cf { color: #007020; font-weight: bold; } 
code span.ch { color: #4070a0; } 
code span.cn { color: #880000; } 
code span.co { color: #60a0b0; font-style: italic; } 
code span.cv { color: #60a0b0; font-weight: bold; font-style: italic; } 
code span.do { color: #ba2121; font-style: italic; } 
code span.dt { color: #902000; } 
code span.dv { color: #40a070; } 
code span.er { color: #ff0000; font-weight: bold; } 
code span.ex { } 
code span.fl { color: #40a070; } 
code span.fu { color: #06287e; } 
code span.im { color: #008000; font-weight: bold; } 
code span.in { color: #60a0b0; font-weight: bold; font-style: italic; } 
code span.kw { color: #007020; font-weight: bold; } 
code span.op { color: #666666; } 
code span.ot { color: #007020; } 
code span.pp { color: #bc7a00; } 
code span.sc { color: #4070a0; } 
code span.ss { color: #bb6688; } 
code span.st { color: #4070a0; } 
code span.va { color: #19177c; } 
code span.vs { color: #4070a0; } 
code span.wa { color: #60a0b0; font-weight: bold; font-style: italic; } 
</style>
<script>
// apply pandoc div.sourceCode style to pre.sourceCode instead
(function() {
  var sheets = document.styleSheets;
  for (var i = 0; i < sheets.length; i++) {
    if (sheets[i].ownerNode.dataset["origin"] !== "pandoc") continue;
    try { var rules = sheets[i].cssRules; } catch (e) { continue; }
    var j = 0;
    while (j < rules.length) {
      var rule = rules[j];
      // check if there is a div.sourceCode rule
      if (rule.type !== rule.STYLE_RULE || rule.selectorText !== "div.sourceCode") {
        j++;
        continue;
      }
      var style = rule.style.cssText;
      // check if color or background-color is set
      if (rule.style.color === '' && rule.style.backgroundColor === '') {
        j++;
        continue;
      }
      // replace div.sourceCode by a pre.sourceCode rule
      sheets[i].deleteRule(j);
      sheets[i].insertRule('pre.sourceCode{' + style + '}', j);
    }
  }
})();
</script>




<style type="text/css">body {
background-color: #fff;
margin: 1em auto;
max-width: 700px;
overflow: visible;
padding-left: 2em;
padding-right: 2em;
font-family: "Open Sans", "Helvetica Neue", Helvetica, Arial, sans-serif;
font-size: 14px;
line-height: 1.35;
}
#TOC {
clear: both;
margin: 0 0 10px 10px;
padding: 4px;
width: 400px;
border: 1px solid #CCCCCC;
border-radius: 5px;
background-color: #f6f6f6;
font-size: 13px;
line-height: 1.3;
}
#TOC .toctitle {
font-weight: bold;
font-size: 15px;
margin-left: 5px;
}
#TOC ul {
padding-left: 40px;
margin-left: -1.5em;
margin-top: 5px;
margin-bottom: 5px;
}
#TOC ul ul {
margin-left: -2em;
}
#TOC li {
line-height: 16px;
}
table {
margin: 1em auto;
border-width: 1px;
border-color: #DDDDDD;
border-style: outset;
border-collapse: collapse;
}
table th {
border-width: 2px;
padding: 5px;
border-style: inset;
}
table td {
border-width: 1px;
border-style: inset;
line-height: 18px;
padding: 5px 5px;
}
table, table th, table td {
border-left-style: none;
border-right-style: none;
}
table thead, table tr.even {
background-color: #f7f7f7;
}
p {
margin: 0.5em 0;
}
blockquote {
background-color: #f6f6f6;
padding: 0.25em 0.75em;
}
hr {
border-style: solid;
border: none;
border-top: 1px solid #777;
margin: 28px 0;
}
dl {
margin-left: 0;
}
dl dd {
margin-bottom: 13px;
margin-left: 13px;
}
dl dt {
font-weight: bold;
}
ul {
margin-top: 0;
}
ul li {
list-style: circle outside;
}
ul ul {
margin-bottom: 0;
}
pre, code {
background-color: #f7f7f7;
border-radius: 3px;
color: #333;
white-space: pre-wrap; 
}
pre {
border-radius: 3px;
margin: 5px 0px 10px 0px;
padding: 10px;
}
pre:not([class]) {
background-color: #f7f7f7;
}
code {
font-family: Consolas, Monaco, 'Courier New', monospace;
font-size: 85%;
}
p > code, li > code {
padding: 2px 0px;
}
div.figure {
text-align: center;
}
img {
background-color: #FFFFFF;
padding: 2px;
border: 1px solid #DDDDDD;
border-radius: 3px;
border: 1px solid #CCCCCC;
margin: 0 5px;
}
h1 {
margin-top: 0;
font-size: 35px;
line-height: 40px;
}
h2 {
border-bottom: 4px solid #f7f7f7;
padding-top: 10px;
padding-bottom: 2px;
font-size: 145%;
}
h3 {
border-bottom: 2px solid #f7f7f7;
padding-top: 10px;
font-size: 120%;
}
h4 {
border-bottom: 1px solid #f7f7f7;
margin-left: 8px;
font-size: 105%;
}
h5, h6 {
border-bottom: 1px solid #ccc;
font-size: 105%;
}
a {
color: #0033dd;
text-decoration: none;
}
a:hover {
color: #6666ff; }
a:visited {
color: #800080; }
a:visited:hover {
color: #BB00BB; }
a[href^="http:"] {
text-decoration: underline; }
a[href^="https:"] {
text-decoration: underline; }

code > span.kw { color: #555; font-weight: bold; } 
code > span.dt { color: #902000; } 
code > span.dv { color: #40a070; } 
code > span.bn { color: #d14; } 
code > span.fl { color: #d14; } 
code > span.ch { color: #d14; } 
code > span.st { color: #d14; } 
code > span.co { color: #888888; font-style: italic; } 
code > span.ot { color: #007020; } 
code > span.al { color: #ff0000; font-weight: bold; } 
code > span.fu { color: #900; font-weight: bold; } 
code > span.er { color: #a61717; background-color: #e3d2d2; } 
</style>




</head>

<body>




<h1 class="title toc-ignore">Examples: A&amp;E data</h1>



<div class="sourceCode" id="cb1"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb1-1"><a href="#cb1-1" tabindex="-1"></a><span class="fu">library</span>(eider)</span>
<span id="cb1-2"><a href="#cb1-2" tabindex="-1"></a><span class="fu">library</span>(magrittr)</span></code></pre></div>
<p>This series of vignettes in the <em>Gallery</em> section aim to
demonstrate the functionality of <code>eider</code> through examples
that are similar to real-life usage. To do this, we have created a
series of randomly generated datasets that are stored with the package.
You can access these datasets using the <code>eider_example()</code>
function, which will return the path to where the dataset is stored in
your installation of R.</p>
<div class="sourceCode" id="cb2"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb2-1"><a href="#cb2-1" tabindex="-1"></a>ae_data_filepath <span class="ot">&lt;-</span> <span class="fu">eider_example</span>(<span class="st">&quot;random_ae_data.csv&quot;</span>)</span>
<span id="cb2-2"><a href="#cb2-2" tabindex="-1"></a></span>
<span id="cb2-3"><a href="#cb2-3" tabindex="-1"></a>ae_data_filepath</span>
<span id="cb2-4"><a href="#cb2-4" tabindex="-1"></a><span class="co">#&gt; [1] &quot;/private/var/folders/zq/08vbt_c13vn2qq5gr_x95vgw0000gr/T/RtmpM9hLMi/Rinst127a44e9601ca/eider/extdata/random_ae_data.csv&quot;</span></span></code></pre></div>
<div id="the-data" class="section level2">
<h2>The data</h2>
<p>In this specific vignette, we are using simulated <a href="https://publichealthscotland.scot/publications/ae-data-mart-user-guide/">accident
and emergency (A&amp;E) data</a>. Our dataset does not contain every
column specified in here, but serves as a useful example of how
real-life data may be treated using <code>eider</code>.</p>
<div class="sourceCode" id="cb3"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb3-1"><a href="#cb3-1" tabindex="-1"></a>ae_data <span class="ot">&lt;-</span> utils<span class="sc">::</span><span class="fu">read.csv</span>(ae_data_filepath) <span class="sc">%&gt;%</span></span>
<span id="cb3-2"><a href="#cb3-2" tabindex="-1"></a>  dplyr<span class="sc">::</span><span class="fu">mutate</span>(<span class="at">date =</span> <span class="fu">as.Date</span>(date))</span>
<span id="cb3-3"><a href="#cb3-3" tabindex="-1"></a></span>
<span id="cb3-4"><a href="#cb3-4" tabindex="-1"></a>dplyr<span class="sc">::</span><span class="fu">glimpse</span>(ae_data)</span>
<span id="cb3-5"><a href="#cb3-5" tabindex="-1"></a><span class="co">#&gt; Rows: 100</span></span>
<span id="cb3-6"><a href="#cb3-6" tabindex="-1"></a><span class="co">#&gt; Columns: 6</span></span>
<span id="cb3-7"><a href="#cb3-7" tabindex="-1"></a><span class="co">#&gt; $ id                  &lt;int&gt; 15, 1, 18, 1, 11, 11, 17, 15, 9, 14, 3, 13, 13, 15…</span></span>
<span id="cb3-8"><a href="#cb3-8" tabindex="-1"></a><span class="co">#&gt; $ date                &lt;date&gt; 2016-03-07, 2016-09-06, 2015-10-23, 2016-02-23, 2…</span></span>
<span id="cb3-9"><a href="#cb3-9" tabindex="-1"></a><span class="co">#&gt; $ attendance_category &lt;int&gt; 5, 5, 5, 4, 2, 3, 3, 5, 4, 4, 5, 3, 5, 2, 5, 1, 1,…</span></span>
<span id="cb3-10"><a href="#cb3-10" tabindex="-1"></a><span class="co">#&gt; $ diagnosis_1         &lt;int&gt; 7, 5, 6, 16, 15, 8, 16, 0, 18, 14, 14, 12, 1, 8, 0…</span></span>
<span id="cb3-11"><a href="#cb3-11" tabindex="-1"></a><span class="co">#&gt; $ diagnosis_2         &lt;int&gt; 19, NA, NA, 2, 6, 5, 18, 12, 3, NA, NA, NA, 3, 9, …</span></span>
<span id="cb3-12"><a href="#cb3-12" tabindex="-1"></a><span class="co">#&gt; $ diagnosis_3         &lt;int&gt; 18, NA, NA, NA, 99, NA, 12, 15, 15, NA, NA, NA, NA…</span></span></code></pre></div>
<p>(Note that when the data is loaded by <code>eider</code>, the date
columns are automatically converted to the date type for you: you do not
need to do the manual processing above.)</p>
<p>This simplified table has 6 columns:</p>
<ul>
<li><code>id</code>, which is a numeric patient ID;</li>
<li><code>date</code>, when the admission occurred;</li>
<li><code>attendance_category</code>, a numeric value indicating <a href="https://publichealthscotland.scot/services/national-data-catalogue/data-dictionary/a-to-z-of-data-dictionary-terms/attendance-category-ae/">the
context for the patient’s admission</a>;</li>
<li><code>diagnosis_1</code>, <code>diagnosis_2</code>, and
<code>diagnosis_3</code>, which are numeric values indicating <a href="https://publichealthscotland.scot/services/national-data-catalogue/data-dictionary/a-to-z-of-data-dictionary-terms/diagnosis-ae/">the
patient’s diagnoses</a>. Note that <code>diagnosis_2</code> and
<code>diagnosis_3</code> may not necessarily exist for every entry.</li>
</ul>
</div>
<div id="feature-1-total-number-of-attendances" class="section level2">
<h2>Feature 1: Total number of attendances</h2>
<p>As a first example, we will calculate the total number of attendances
for each patient. This feature may be specified in JSON as follows:</p>
<div class="sourceCode" id="cb4"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb4-1"><a href="#cb4-1" tabindex="-1"></a>ae_count_filepath <span class="ot">&lt;-</span> <span class="fu">eider_example</span>(<span class="st">&quot;ae_total_attendances.json&quot;</span>)</span>
<span id="cb4-2"><a href="#cb4-2" tabindex="-1"></a><span class="fu">writeLines</span>(<span class="fu">readLines</span>(ae_count_filepath))</span>
<span id="cb4-3"><a href="#cb4-3" tabindex="-1"></a><span class="co">#&gt; {</span></span>
<span id="cb4-4"><a href="#cb4-4" tabindex="-1"></a><span class="co">#&gt;   &quot;source_table&quot;: &quot;ae&quot;,</span></span>
<span id="cb4-5"><a href="#cb4-5" tabindex="-1"></a><span class="co">#&gt;   &quot;transformation_type&quot;: &quot;count&quot;,</span></span>
<span id="cb4-6"><a href="#cb4-6" tabindex="-1"></a><span class="co">#&gt;   &quot;grouping_column&quot;: &quot;id&quot;,</span></span>
<span id="cb4-7"><a href="#cb4-7" tabindex="-1"></a><span class="co">#&gt;   &quot;absent_default_value&quot;: 0,</span></span>
<span id="cb4-8"><a href="#cb4-8" tabindex="-1"></a><span class="co">#&gt;   &quot;output_feature_name&quot;: &quot;total_ae_attendances&quot;</span></span>
<span id="cb4-9"><a href="#cb4-9" tabindex="-1"></a><span class="co">#&gt; }</span></span></code></pre></div>
<p>This JSON file is also provided as part of the package, and as with
the data, can be accessed using the <code>eider_example()</code>
function. It contains the following information:</p>
<ul>
<li><code>source_table</code> specifies the identifier by which the
input table is provided to <code>eider</code>;</li>
<li><code>output_feature_name</code> specifies the name of the column
that will be created in the output table;</li>
<li><code>absent_default_value</code> specifies the value that will be
used when a patient does not appear in the table. In this case, the
logical value to use is 0: if a patient does not appear in the A&amp;E
table, it means they have 0 attendances.</li>
<li><code>grouping_column</code> specifies the column by which the table
will be grouped. In this case, it is the <code>id</code> column.</li>
<li><code>transformation_type</code> specifies the way in which the
feature is calculated. Here, a value of <code>&quot;count&quot;</code> means that
the number of rows for each <code>id</code> will simply be counted.</li>
</ul>
<p>This is one of the simplest possible features that can be calculated
using <code>eider</code>. It can be run using the
<code>run_pipeline()</code> function:</p>
<div class="sourceCode" id="cb5"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb5-1"><a href="#cb5-1" tabindex="-1"></a>res <span class="ot">&lt;-</span> <span class="fu">run_pipeline</span>(</span>
<span id="cb5-2"><a href="#cb5-2" tabindex="-1"></a>  <span class="at">data_sources =</span> <span class="fu">list</span>(<span class="at">ae =</span> ae_data_filepath),</span>
<span id="cb5-3"><a href="#cb5-3" tabindex="-1"></a>  <span class="at">feature_filenames =</span> ae_count_filepath</span>
<span id="cb5-4"><a href="#cb5-4" tabindex="-1"></a>)</span>
<span id="cb5-5"><a href="#cb5-5" tabindex="-1"></a></span>
<span id="cb5-6"><a href="#cb5-6" tabindex="-1"></a>dplyr<span class="sc">::</span><span class="fu">glimpse</span>(res<span class="sc">$</span>features)</span>
<span id="cb5-7"><a href="#cb5-7" tabindex="-1"></a><span class="co">#&gt; Rows: 20</span></span>
<span id="cb5-8"><a href="#cb5-8" tabindex="-1"></a><span class="co">#&gt; Columns: 2</span></span>
<span id="cb5-9"><a href="#cb5-9" tabindex="-1"></a><span class="co">#&gt; $ id                   &lt;int&gt; 0, 1, 2, 3, 4, 5, 6, 7, 8, 9, 10, 11, 12, 13, 14,…</span></span>
<span id="cb5-10"><a href="#cb5-10" tabindex="-1"></a><span class="co">#&gt; $ total_ae_attendances &lt;int&gt; 6, 4, 6, 3, 5, 4, 6, 5, 5, 10, 4, 5, 4, 8, 4, 7, …</span></span></code></pre></div>
<p>As described in the <a href="eider.html">introductory vignette</a>,
the <code>run_pipeline()</code> function returns both <em>features</em>
and <em>responses</em>. In this case, because we provided
<code>ae_count_filepath</code> as one of the
<code>feature_filenames</code>, the data we are interested in is
returned as part of <code>res$features</code>.</p>
<p>Notice also how the <code>data_sources</code> argument takes a named
list. The names of this list are used to match the
<code>source_table</code> in the JSON file to the actual data. In this
case, because the <code>source_table</code> is <code>&quot;ae&quot;</code>, we
need to specify the data to be used as
<code>ae = ae_data_filepath</code>.</p>
</div>
<div id="feature-2-total-number-of-neurology-attendances-in-2017" class="section level2">
<h2>Feature 2: Total number of neurology attendances in 2017</h2>
<p>As a second example, we will calculate the total number of
attendances for each patient for which:</p>
<ul>
<li>the date is within 2017; and</li>
<li>they have a diagnosis pertaining to neurology (which corresponds to
a diagnosis code of 13).</li>
</ul>
<p>As before, this feature is still a <code>&quot;count&quot;</code>
transformation. However, we must additionally apply a filter to the the
table before performing the count, to ensure that only the rows we are
interested in are counted (see <a href="filtering.html">the filtering
vignette</a> for more examples of this).</p>
<div id="the-date" class="section level3">
<h3>The date</h3>
<p>In this filter, we want to constrain the date to be between 1 January
2017 and 31 December 2017. There is no specific filter for a date range;
however, we can construct this as the <a href="https://en.wikipedia.org/wiki/Logical_conjunction">conjunction</a>
of two subfilters: one which restricts the date to be on or after 1
January 2017, and one which restricts it to be on or before 31 December
2017. Both of these filters must be simultaneously satisfied; thus, we
need to use an <code>&quot;and&quot;</code> filter:</p>
<div class="sourceCode" id="cb6"><pre class="sourceCode json"><code class="sourceCode json"><span id="cb6-1"><a href="#cb6-1" tabindex="-1"></a><span class="fu">{</span></span>
<span id="cb6-2"><a href="#cb6-2" tabindex="-1"></a>    <span class="er">...</span><span class="fu">,</span></span>
<span id="cb6-3"><a href="#cb6-3" tabindex="-1"></a>    <span class="dt">&quot;filter&quot;</span><span class="fu">:</span> <span class="fu">{</span></span>
<span id="cb6-4"><a href="#cb6-4" tabindex="-1"></a>        <span class="dt">&quot;type&quot;</span><span class="fu">:</span> <span class="st">&quot;and&quot;</span><span class="fu">,</span></span>
<span id="cb6-5"><a href="#cb6-5" tabindex="-1"></a>        <span class="dt">&quot;subfilter&quot;</span><span class="fu">:</span> <span class="fu">{</span></span>
<span id="cb6-6"><a href="#cb6-6" tabindex="-1"></a>            <span class="dt">&quot;date1&quot;</span><span class="fu">:</span> <span class="fu">{</span></span>
<span id="cb6-7"><a href="#cb6-7" tabindex="-1"></a>                <span class="dt">&quot;column&quot;</span><span class="fu">:</span> <span class="st">&quot;date&quot;</span><span class="fu">,</span></span>
<span id="cb6-8"><a href="#cb6-8" tabindex="-1"></a>                <span class="dt">&quot;type&quot;</span><span class="fu">:</span> <span class="st">&quot;date_gt_eq&quot;</span><span class="fu">,</span></span>
<span id="cb6-9"><a href="#cb6-9" tabindex="-1"></a>                <span class="dt">&quot;value&quot;</span><span class="fu">:</span> <span class="st">&quot;2017-01-01&quot;</span></span>
<span id="cb6-10"><a href="#cb6-10" tabindex="-1"></a>            <span class="fu">},</span></span>
<span id="cb6-11"><a href="#cb6-11" tabindex="-1"></a>            <span class="dt">&quot;date2&quot;</span><span class="fu">:</span> <span class="fu">{</span></span>
<span id="cb6-12"><a href="#cb6-12" tabindex="-1"></a>                <span class="dt">&quot;column&quot;</span><span class="fu">:</span> <span class="st">&quot;date&quot;</span><span class="fu">,</span></span>
<span id="cb6-13"><a href="#cb6-13" tabindex="-1"></a>                <span class="dt">&quot;type&quot;</span><span class="fu">:</span> <span class="st">&quot;date_lt_eq&quot;</span><span class="fu">,</span></span>
<span id="cb6-14"><a href="#cb6-14" tabindex="-1"></a>                <span class="dt">&quot;value&quot;</span><span class="fu">:</span> <span class="st">&quot;2017-12-31&quot;</span></span>
<span id="cb6-15"><a href="#cb6-15" tabindex="-1"></a>            <span class="fu">}</span></span>
<span id="cb6-16"><a href="#cb6-16" tabindex="-1"></a>        <span class="fu">}</span></span>
<span id="cb6-17"><a href="#cb6-17" tabindex="-1"></a>    <span class="fu">}</span></span>
<span id="cb6-18"><a href="#cb6-18" tabindex="-1"></a><span class="fu">}</span></span></code></pre></div>
<p>Note that the names for the subfilters—<code>&quot;date1&quot;</code> and
<code>&quot;date2&quot;</code>—are arbitrary; they are just used to distinguish
between the two subfilters. You can choose any names you consider
useful.</p>
</div>
<div id="the-diagnosis" class="section level3">
<h3>The diagnosis</h3>
<p>Because the numeric diagnosis can occur in any of the three diagnosis
columns, we need to check all three and retain any rows where any of the
three diagnosis columns are equal to 13.</p>
<p>This is accomplished with an <code>&quot;or&quot;</code> filter:</p>
<div class="sourceCode" id="cb7"><pre class="sourceCode json"><code class="sourceCode json"><span id="cb7-1"><a href="#cb7-1" tabindex="-1"></a><span class="fu">{</span></span>
<span id="cb7-2"><a href="#cb7-2" tabindex="-1"></a>    <span class="er">...</span><span class="fu">,</span></span>
<span id="cb7-3"><a href="#cb7-3" tabindex="-1"></a>    <span class="dt">&quot;filter&quot;</span><span class="fu">:</span> <span class="fu">{</span></span>
<span id="cb7-4"><a href="#cb7-4" tabindex="-1"></a>        <span class="dt">&quot;type&quot;</span><span class="fu">:</span> <span class="st">&quot;or&quot;</span><span class="fu">,</span></span>
<span id="cb7-5"><a href="#cb7-5" tabindex="-1"></a>        <span class="dt">&quot;subfilter&quot;</span><span class="fu">:</span> <span class="fu">{</span></span>
<span id="cb7-6"><a href="#cb7-6" tabindex="-1"></a>            <span class="dt">&quot;diag1&quot;</span><span class="fu">:</span> <span class="fu">{</span></span>
<span id="cb7-7"><a href="#cb7-7" tabindex="-1"></a>                <span class="dt">&quot;column&quot;</span><span class="fu">:</span> <span class="st">&quot;diagnosis_1&quot;</span><span class="fu">,</span></span>
<span id="cb7-8"><a href="#cb7-8" tabindex="-1"></a>                <span class="dt">&quot;type&quot;</span><span class="fu">:</span> <span class="st">&quot;in&quot;</span><span class="fu">,</span></span>
<span id="cb7-9"><a href="#cb7-9" tabindex="-1"></a>                <span class="dt">&quot;value&quot;</span><span class="fu">:</span> <span class="ot">[</span><span class="dv">13</span><span class="ot">]</span></span>
<span id="cb7-10"><a href="#cb7-10" tabindex="-1"></a>            <span class="fu">},</span></span>
<span id="cb7-11"><a href="#cb7-11" tabindex="-1"></a>            <span class="dt">&quot;diag2&quot;</span><span class="fu">:</span> <span class="fu">{</span></span>
<span id="cb7-12"><a href="#cb7-12" tabindex="-1"></a>                <span class="dt">&quot;column&quot;</span><span class="fu">:</span> <span class="st">&quot;diagnosis_2&quot;</span><span class="fu">,</span></span>
<span id="cb7-13"><a href="#cb7-13" tabindex="-1"></a>                <span class="dt">&quot;type&quot;</span><span class="fu">:</span> <span class="st">&quot;in&quot;</span><span class="fu">,</span></span>
<span id="cb7-14"><a href="#cb7-14" tabindex="-1"></a>                <span class="dt">&quot;value&quot;</span><span class="fu">:</span> <span class="ot">[</span><span class="dv">13</span><span class="ot">]</span></span>
<span id="cb7-15"><a href="#cb7-15" tabindex="-1"></a>            <span class="fu">},</span></span>
<span id="cb7-16"><a href="#cb7-16" tabindex="-1"></a>            <span class="dt">&quot;diag3&quot;</span><span class="fu">:</span> <span class="fu">{</span></span>
<span id="cb7-17"><a href="#cb7-17" tabindex="-1"></a>                <span class="dt">&quot;column&quot;</span><span class="fu">:</span> <span class="st">&quot;diagnosis_3&quot;</span><span class="fu">,</span></span>
<span id="cb7-18"><a href="#cb7-18" tabindex="-1"></a>                <span class="dt">&quot;type&quot;</span><span class="fu">:</span> <span class="st">&quot;in&quot;</span><span class="fu">,</span></span>
<span id="cb7-19"><a href="#cb7-19" tabindex="-1"></a>                <span class="dt">&quot;value&quot;</span><span class="fu">:</span> <span class="ot">[</span><span class="dv">13</span><span class="ot">]</span></span>
<span id="cb7-20"><a href="#cb7-20" tabindex="-1"></a>            <span class="fu">}</span></span>
<span id="cb7-21"><a href="#cb7-21" tabindex="-1"></a>        <span class="fu">}</span></span>
<span id="cb7-22"><a href="#cb7-22" tabindex="-1"></a>    <span class="fu">}</span></span>
<span id="cb7-23"><a href="#cb7-23" tabindex="-1"></a><span class="fu">}</span></span></code></pre></div>
</div>
<div id="combining-both-filters" class="section level3">
<h3>Combining both filters</h3>
<p>To combine both filters, we can nest both of these within an
<code>&quot;and&quot;</code> filter.</p>
<div class="sourceCode" id="cb8"><pre class="sourceCode json"><code class="sourceCode json"><span id="cb8-1"><a href="#cb8-1" tabindex="-1"></a><span class="fu">{</span></span>
<span id="cb8-2"><a href="#cb8-2" tabindex="-1"></a>    <span class="er">...</span><span class="fu">,</span></span>
<span id="cb8-3"><a href="#cb8-3" tabindex="-1"></a>    <span class="dt">&quot;filter&quot;</span><span class="fu">:</span> <span class="fu">{</span></span>
<span id="cb8-4"><a href="#cb8-4" tabindex="-1"></a>        <span class="dt">&quot;type&quot;</span><span class="fu">:</span> <span class="st">&quot;and&quot;</span><span class="fu">,</span></span>
<span id="cb8-5"><a href="#cb8-5" tabindex="-1"></a>        <span class="dt">&quot;subfilter&quot;</span><span class="fu">:</span> <span class="fu">{</span></span>
<span id="cb8-6"><a href="#cb8-6" tabindex="-1"></a>            <span class="dt">&quot;date&quot;</span><span class="fu">:</span> <span class="fu">{</span></span>
<span id="cb8-7"><a href="#cb8-7" tabindex="-1"></a>                <span class="dt">&quot;type&quot;</span><span class="fu">:</span> <span class="st">&quot;and&quot;</span><span class="fu">,</span></span>
<span id="cb8-8"><a href="#cb8-8" tabindex="-1"></a>                <span class="dt">&quot;subfilter&quot;</span><span class="fu">:</span> <span class="fu">{</span></span>
<span id="cb8-9"><a href="#cb8-9" tabindex="-1"></a>                    <span class="dt">&quot;date1&quot;</span><span class="fu">:</span> <span class="fu">{</span></span>
<span id="cb8-10"><a href="#cb8-10" tabindex="-1"></a>                        <span class="dt">&quot;column&quot;</span><span class="fu">:</span> <span class="st">&quot;date&quot;</span><span class="fu">,</span></span>
<span id="cb8-11"><a href="#cb8-11" tabindex="-1"></a>                        <span class="dt">&quot;type&quot;</span><span class="fu">:</span> <span class="st">&quot;date_gt_eq&quot;</span><span class="fu">,</span></span>
<span id="cb8-12"><a href="#cb8-12" tabindex="-1"></a>                        <span class="dt">&quot;value&quot;</span><span class="fu">:</span> <span class="st">&quot;2017-01-01&quot;</span></span>
<span id="cb8-13"><a href="#cb8-13" tabindex="-1"></a>                    <span class="fu">},</span></span>
<span id="cb8-14"><a href="#cb8-14" tabindex="-1"></a>                    <span class="dt">&quot;date2&quot;</span><span class="fu">:</span> <span class="fu">{</span></span>
<span id="cb8-15"><a href="#cb8-15" tabindex="-1"></a>                        <span class="dt">&quot;column&quot;</span><span class="fu">:</span> <span class="st">&quot;date&quot;</span><span class="fu">,</span></span>
<span id="cb8-16"><a href="#cb8-16" tabindex="-1"></a>                        <span class="dt">&quot;type&quot;</span><span class="fu">:</span> <span class="st">&quot;date_lt_eq&quot;</span><span class="fu">,</span></span>
<span id="cb8-17"><a href="#cb8-17" tabindex="-1"></a>                        <span class="dt">&quot;value&quot;</span><span class="fu">:</span> <span class="st">&quot;2017-12-31&quot;</span></span>
<span id="cb8-18"><a href="#cb8-18" tabindex="-1"></a>                    <span class="fu">}</span></span>
<span id="cb8-19"><a href="#cb8-19" tabindex="-1"></a>                <span class="fu">}</span></span>
<span id="cb8-20"><a href="#cb8-20" tabindex="-1"></a>            <span class="fu">},</span></span>
<span id="cb8-21"><a href="#cb8-21" tabindex="-1"></a>            <span class="dt">&quot;diag&quot;</span><span class="fu">:</span> <span class="fu">{</span></span>
<span id="cb8-22"><a href="#cb8-22" tabindex="-1"></a>                <span class="dt">&quot;type&quot;</span><span class="fu">:</span> <span class="st">&quot;or&quot;</span><span class="fu">,</span></span>
<span id="cb8-23"><a href="#cb8-23" tabindex="-1"></a>                <span class="dt">&quot;subfilter&quot;</span><span class="fu">:</span> <span class="fu">{</span></span>
<span id="cb8-24"><a href="#cb8-24" tabindex="-1"></a>                      <span class="dt">&quot;diag1&quot;</span><span class="fu">:</span> <span class="fu">{</span></span>
<span id="cb8-25"><a href="#cb8-25" tabindex="-1"></a>                          <span class="dt">&quot;column&quot;</span><span class="fu">:</span> <span class="st">&quot;diagnosis_1&quot;</span><span class="fu">,</span></span>
<span id="cb8-26"><a href="#cb8-26" tabindex="-1"></a>                          <span class="dt">&quot;type&quot;</span><span class="fu">:</span> <span class="st">&quot;in&quot;</span><span class="fu">,</span></span>
<span id="cb8-27"><a href="#cb8-27" tabindex="-1"></a>                          <span class="dt">&quot;value&quot;</span><span class="fu">:</span> <span class="ot">[</span><span class="dv">13</span><span class="ot">]</span></span>
<span id="cb8-28"><a href="#cb8-28" tabindex="-1"></a>                      <span class="fu">},</span></span>
<span id="cb8-29"><a href="#cb8-29" tabindex="-1"></a>                      <span class="dt">&quot;diag2&quot;</span><span class="fu">:</span> <span class="fu">{</span></span>
<span id="cb8-30"><a href="#cb8-30" tabindex="-1"></a>                          <span class="dt">&quot;column&quot;</span><span class="fu">:</span> <span class="st">&quot;diagnosis_2&quot;</span><span class="fu">,</span></span>
<span id="cb8-31"><a href="#cb8-31" tabindex="-1"></a>                          <span class="dt">&quot;type&quot;</span><span class="fu">:</span> <span class="st">&quot;in&quot;</span><span class="fu">,</span></span>
<span id="cb8-32"><a href="#cb8-32" tabindex="-1"></a>                          <span class="dt">&quot;value&quot;</span><span class="fu">:</span> <span class="ot">[</span><span class="dv">13</span><span class="ot">]</span></span>
<span id="cb8-33"><a href="#cb8-33" tabindex="-1"></a>                      <span class="fu">},</span></span>
<span id="cb8-34"><a href="#cb8-34" tabindex="-1"></a>                      <span class="dt">&quot;diag3&quot;</span><span class="fu">:</span> <span class="fu">{</span></span>
<span id="cb8-35"><a href="#cb8-35" tabindex="-1"></a>                          <span class="dt">&quot;column&quot;</span><span class="fu">:</span> <span class="st">&quot;diagnosis_3&quot;</span><span class="fu">,</span></span>
<span id="cb8-36"><a href="#cb8-36" tabindex="-1"></a>                          <span class="dt">&quot;type&quot;</span><span class="fu">:</span> <span class="st">&quot;in&quot;</span><span class="fu">,</span></span>
<span id="cb8-37"><a href="#cb8-37" tabindex="-1"></a>                          <span class="dt">&quot;value&quot;</span><span class="fu">:</span> <span class="ot">[</span><span class="dv">13</span><span class="ot">]</span></span>
<span id="cb8-38"><a href="#cb8-38" tabindex="-1"></a>                      <span class="fu">}</span></span>
<span id="cb8-39"><a href="#cb8-39" tabindex="-1"></a>                <span class="fu">}</span></span>
<span id="cb8-40"><a href="#cb8-40" tabindex="-1"></a>            <span class="fu">}</span></span>
<span id="cb8-41"><a href="#cb8-41" tabindex="-1"></a>        <span class="fu">}</span></span>
<span id="cb8-42"><a href="#cb8-42" tabindex="-1"></a>    <span class="fu">}</span></span>
<span id="cb8-43"><a href="#cb8-43" tabindex="-1"></a><span class="fu">}</span></span></code></pre></div>
<p>Note that this can in principle be simplified, because</p>
<pre><code>(date1 AND date2) AND (diag1 OR diag2 OR diag3)</code></pre>
<p>is really the same as</p>
<pre><code>date1 AND date2 AND (diag1 OR diag2 OR diag3)</code></pre>
<p>and so we do not really need to nest the filters so deeply. However,
the above will work correctly, so we will keep it as it is.</p>
</div>
<div id="the-feature" class="section level3">
<h3>The feature</h3>
<p>The JSON file for this feature is again provided as part of the
package. It is exactly the same as the earlier example, except that the
filter above has been added in.</p>
<div class="sourceCode" id="cb11"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb11-1"><a href="#cb11-1" tabindex="-1"></a>ae_neurology_filepath <span class="ot">&lt;-</span> <span class="fu">eider_example</span>(<span class="st">&quot;ae_attendances_neurology_2017.json&quot;</span>)</span>
<span id="cb11-2"><a href="#cb11-2" tabindex="-1"></a><span class="fu">writeLines</span>(<span class="fu">readLines</span>(ae_neurology_filepath))</span>
<span id="cb11-3"><a href="#cb11-3" tabindex="-1"></a><span class="co">#&gt; {</span></span>
<span id="cb11-4"><a href="#cb11-4" tabindex="-1"></a><span class="co">#&gt;   &quot;source_table&quot;: &quot;ae&quot;,</span></span>
<span id="cb11-5"><a href="#cb11-5" tabindex="-1"></a><span class="co">#&gt;   &quot;transformation_type&quot;: &quot;count&quot;,</span></span>
<span id="cb11-6"><a href="#cb11-6" tabindex="-1"></a><span class="co">#&gt;   &quot;grouping_column&quot;: &quot;id&quot;,</span></span>
<span id="cb11-7"><a href="#cb11-7" tabindex="-1"></a><span class="co">#&gt;   &quot;absent_default_value&quot;: 0,</span></span>
<span id="cb11-8"><a href="#cb11-8" tabindex="-1"></a><span class="co">#&gt;   &quot;output_feature_name&quot;: &quot;total_neurology_ae_attendances&quot;,</span></span>
<span id="cb11-9"><a href="#cb11-9" tabindex="-1"></a><span class="co">#&gt;   &quot;filter&quot;: {</span></span>
<span id="cb11-10"><a href="#cb11-10" tabindex="-1"></a><span class="co">#&gt;     &quot;type&quot;: &quot;and&quot;,</span></span>
<span id="cb11-11"><a href="#cb11-11" tabindex="-1"></a><span class="co">#&gt;     &quot;subfilter&quot;: {</span></span>
<span id="cb11-12"><a href="#cb11-12" tabindex="-1"></a><span class="co">#&gt;       &quot;date&quot;: {</span></span>
<span id="cb11-13"><a href="#cb11-13" tabindex="-1"></a><span class="co">#&gt;         &quot;type&quot;: &quot;and&quot;,</span></span>
<span id="cb11-14"><a href="#cb11-14" tabindex="-1"></a><span class="co">#&gt;         &quot;subfilter&quot;: {</span></span>
<span id="cb11-15"><a href="#cb11-15" tabindex="-1"></a><span class="co">#&gt;           &quot;date1&quot;: {</span></span>
<span id="cb11-16"><a href="#cb11-16" tabindex="-1"></a><span class="co">#&gt;             &quot;column&quot;: &quot;date&quot;,</span></span>
<span id="cb11-17"><a href="#cb11-17" tabindex="-1"></a><span class="co">#&gt;             &quot;type&quot;: &quot;date_gt_eq&quot;,</span></span>
<span id="cb11-18"><a href="#cb11-18" tabindex="-1"></a><span class="co">#&gt;             &quot;value&quot;: &quot;2017-01-01&quot;</span></span>
<span id="cb11-19"><a href="#cb11-19" tabindex="-1"></a><span class="co">#&gt;           },</span></span>
<span id="cb11-20"><a href="#cb11-20" tabindex="-1"></a><span class="co">#&gt;           &quot;date2&quot;: {</span></span>
<span id="cb11-21"><a href="#cb11-21" tabindex="-1"></a><span class="co">#&gt;             &quot;column&quot;: &quot;date&quot;,</span></span>
<span id="cb11-22"><a href="#cb11-22" tabindex="-1"></a><span class="co">#&gt;             &quot;type&quot;: &quot;date_lt_eq&quot;,</span></span>
<span id="cb11-23"><a href="#cb11-23" tabindex="-1"></a><span class="co">#&gt;             &quot;value&quot;: &quot;2017-12-31&quot;</span></span>
<span id="cb11-24"><a href="#cb11-24" tabindex="-1"></a><span class="co">#&gt;           }</span></span>
<span id="cb11-25"><a href="#cb11-25" tabindex="-1"></a><span class="co">#&gt;         }</span></span>
<span id="cb11-26"><a href="#cb11-26" tabindex="-1"></a><span class="co">#&gt;       },</span></span>
<span id="cb11-27"><a href="#cb11-27" tabindex="-1"></a><span class="co">#&gt;       &quot;diag&quot;: {</span></span>
<span id="cb11-28"><a href="#cb11-28" tabindex="-1"></a><span class="co">#&gt;         &quot;type&quot;: &quot;or&quot;,</span></span>
<span id="cb11-29"><a href="#cb11-29" tabindex="-1"></a><span class="co">#&gt;         &quot;subfilter&quot;: {</span></span>
<span id="cb11-30"><a href="#cb11-30" tabindex="-1"></a><span class="co">#&gt;           &quot;diag1&quot;: {</span></span>
<span id="cb11-31"><a href="#cb11-31" tabindex="-1"></a><span class="co">#&gt;             &quot;column&quot;: &quot;diagnosis_1&quot;,</span></span>
<span id="cb11-32"><a href="#cb11-32" tabindex="-1"></a><span class="co">#&gt;             &quot;type&quot;: &quot;in&quot;,</span></span>
<span id="cb11-33"><a href="#cb11-33" tabindex="-1"></a><span class="co">#&gt;             &quot;value&quot;: [</span></span>
<span id="cb11-34"><a href="#cb11-34" tabindex="-1"></a><span class="co">#&gt;               13</span></span>
<span id="cb11-35"><a href="#cb11-35" tabindex="-1"></a><span class="co">#&gt;             ]</span></span>
<span id="cb11-36"><a href="#cb11-36" tabindex="-1"></a><span class="co">#&gt;           },</span></span>
<span id="cb11-37"><a href="#cb11-37" tabindex="-1"></a><span class="co">#&gt;           &quot;diag2&quot;: {</span></span>
<span id="cb11-38"><a href="#cb11-38" tabindex="-1"></a><span class="co">#&gt;             &quot;column&quot;: &quot;diagnosis_2&quot;,</span></span>
<span id="cb11-39"><a href="#cb11-39" tabindex="-1"></a><span class="co">#&gt;             &quot;type&quot;: &quot;in&quot;,</span></span>
<span id="cb11-40"><a href="#cb11-40" tabindex="-1"></a><span class="co">#&gt;             &quot;value&quot;: [</span></span>
<span id="cb11-41"><a href="#cb11-41" tabindex="-1"></a><span class="co">#&gt;               13</span></span>
<span id="cb11-42"><a href="#cb11-42" tabindex="-1"></a><span class="co">#&gt;             ]</span></span>
<span id="cb11-43"><a href="#cb11-43" tabindex="-1"></a><span class="co">#&gt;           },</span></span>
<span id="cb11-44"><a href="#cb11-44" tabindex="-1"></a><span class="co">#&gt;           &quot;diag3&quot;: {</span></span>
<span id="cb11-45"><a href="#cb11-45" tabindex="-1"></a><span class="co">#&gt;             &quot;column&quot;: &quot;diagnosis_3&quot;,</span></span>
<span id="cb11-46"><a href="#cb11-46" tabindex="-1"></a><span class="co">#&gt;             &quot;type&quot;: &quot;in&quot;,</span></span>
<span id="cb11-47"><a href="#cb11-47" tabindex="-1"></a><span class="co">#&gt;             &quot;value&quot;: [</span></span>
<span id="cb11-48"><a href="#cb11-48" tabindex="-1"></a><span class="co">#&gt;               13</span></span>
<span id="cb11-49"><a href="#cb11-49" tabindex="-1"></a><span class="co">#&gt;             ]</span></span>
<span id="cb11-50"><a href="#cb11-50" tabindex="-1"></a><span class="co">#&gt;           }</span></span>
<span id="cb11-51"><a href="#cb11-51" tabindex="-1"></a><span class="co">#&gt;         }</span></span>
<span id="cb11-52"><a href="#cb11-52" tabindex="-1"></a><span class="co">#&gt;       }</span></span>
<span id="cb11-53"><a href="#cb11-53" tabindex="-1"></a><span class="co">#&gt;     }</span></span>
<span id="cb11-54"><a href="#cb11-54" tabindex="-1"></a><span class="co">#&gt;   }</span></span>
<span id="cb11-55"><a href="#cb11-55" tabindex="-1"></a><span class="co">#&gt; }</span></span></code></pre></div>
<p>This feature can be run in the same way as the previous one. To make
things slightly more interesting, we will provide both features to
<code>run_pipeline()</code> at the same time:</p>
<div class="sourceCode" id="cb12"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb12-1"><a href="#cb12-1" tabindex="-1"></a>res <span class="ot">&lt;-</span> <span class="fu">run_pipeline</span>(</span>
<span id="cb12-2"><a href="#cb12-2" tabindex="-1"></a>  <span class="at">data_sources =</span> <span class="fu">list</span>(<span class="at">ae =</span> ae_data_filepath),</span>
<span id="cb12-3"><a href="#cb12-3" tabindex="-1"></a>  <span class="at">feature_filenames =</span> <span class="fu">c</span>(ae_count_filepath, ae_neurology_filepath)</span>
<span id="cb12-4"><a href="#cb12-4" tabindex="-1"></a>)</span>
<span id="cb12-5"><a href="#cb12-5" tabindex="-1"></a></span>
<span id="cb12-6"><a href="#cb12-6" tabindex="-1"></a>dplyr<span class="sc">::</span><span class="fu">glimpse</span>(res<span class="sc">$</span>features)</span>
<span id="cb12-7"><a href="#cb12-7" tabindex="-1"></a><span class="co">#&gt; Rows: 20</span></span>
<span id="cb12-8"><a href="#cb12-8" tabindex="-1"></a><span class="co">#&gt; Columns: 3</span></span>
<span id="cb12-9"><a href="#cb12-9" tabindex="-1"></a><span class="co">#&gt; $ id                             &lt;int&gt; 0, 1, 2, 3, 4, 5, 6, 7, 8, 9, 10, 11, 1…</span></span>
<span id="cb12-10"><a href="#cb12-10" tabindex="-1"></a><span class="co">#&gt; $ total_ae_attendances           &lt;int&gt; 6, 4, 6, 3, 5, 4, 6, 5, 5, 10, 4, 5, 4,…</span></span>
<span id="cb12-11"><a href="#cb12-11" tabindex="-1"></a><span class="co">#&gt; $ total_neurology_ae_attendances &lt;int&gt; 0, 0, 1, 0, 0, 0, 1, 0, 0, 0, 0, 0, 0, …</span></span></code></pre></div>
<p>In this case, we can see that patient 0 (for example) has had 9 total
attendances, but only 1 of these were in 2017 and resulted in a
neurology diagnosis.</p>
</div>
</div>
<div id="checking-the-results-so-far" class="section level2">
<h2>Checking the results (so far)</h2>
<p>We can verify some of the results above using a standard
<code>dplyr</code> pipeline. For feature 1:</p>
<div class="sourceCode" id="cb13"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb13-1"><a href="#cb13-1" tabindex="-1"></a>ae_data <span class="sc">%&gt;%</span></span>
<span id="cb13-2"><a href="#cb13-2" tabindex="-1"></a>  dplyr<span class="sc">::</span><span class="fu">group_by</span>(id) <span class="sc">%&gt;%</span></span>
<span id="cb13-3"><a href="#cb13-3" tabindex="-1"></a>  dplyr<span class="sc">::</span><span class="fu">summarise</span>(<span class="at">total_ae_attendances =</span> dplyr<span class="sc">::</span><span class="fu">n</span>()) <span class="sc">%&gt;%</span></span>
<span id="cb13-4"><a href="#cb13-4" tabindex="-1"></a>  dplyr<span class="sc">::</span><span class="fu">glimpse</span>()</span>
<span id="cb13-5"><a href="#cb13-5" tabindex="-1"></a><span class="co">#&gt; Rows: 20</span></span>
<span id="cb13-6"><a href="#cb13-6" tabindex="-1"></a><span class="co">#&gt; Columns: 2</span></span>
<span id="cb13-7"><a href="#cb13-7" tabindex="-1"></a><span class="co">#&gt; $ id                   &lt;int&gt; 0, 1, 2, 3, 4, 5, 6, 7, 8, 9, 10, 11, 12, 13, 14,…</span></span>
<span id="cb13-8"><a href="#cb13-8" tabindex="-1"></a><span class="co">#&gt; $ total_ae_attendances &lt;int&gt; 6, 4, 6, 3, 5, 4, 6, 5, 5, 10, 4, 5, 4, 8, 4, 7, …</span></span></code></pre></div>
<p>and for feature 2:</p>
<div class="sourceCode" id="cb14"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb14-1"><a href="#cb14-1" tabindex="-1"></a>ae_data <span class="sc">%&gt;%</span></span>
<span id="cb14-2"><a href="#cb14-2" tabindex="-1"></a>  dplyr<span class="sc">::</span><span class="fu">filter</span>(date <span class="sc">&gt;=</span> <span class="st">&quot;2017-01-01&quot;</span>, date <span class="sc">&lt;=</span> <span class="st">&quot;2017-12-31&quot;</span>) <span class="sc">%&gt;%</span></span>
<span id="cb14-3"><a href="#cb14-3" tabindex="-1"></a>  dplyr<span class="sc">::</span><span class="fu">filter</span>(diagnosis_1 <span class="sc">==</span> <span class="dv">13</span> <span class="sc">|</span> diagnosis_2 <span class="sc">==</span> <span class="dv">13</span> <span class="sc">|</span> diagnosis_3 <span class="sc">==</span> <span class="dv">13</span>) <span class="sc">%&gt;%</span></span>
<span id="cb14-4"><a href="#cb14-4" tabindex="-1"></a>  dplyr<span class="sc">::</span><span class="fu">group_by</span>(id) <span class="sc">%&gt;%</span></span>
<span id="cb14-5"><a href="#cb14-5" tabindex="-1"></a>  dplyr<span class="sc">::</span><span class="fu">summarise</span>(<span class="at">total_neurology_ae_attendances =</span> dplyr<span class="sc">::</span><span class="fu">n</span>()) <span class="sc">%&gt;%</span></span>
<span id="cb14-6"><a href="#cb14-6" tabindex="-1"></a>  dplyr<span class="sc">::</span><span class="fu">glimpse</span>()</span>
<span id="cb14-7"><a href="#cb14-7" tabindex="-1"></a><span class="co">#&gt; Rows: 2</span></span>
<span id="cb14-8"><a href="#cb14-8" tabindex="-1"></a><span class="co">#&gt; Columns: 2</span></span>
<span id="cb14-9"><a href="#cb14-9" tabindex="-1"></a><span class="co">#&gt; $ id                             &lt;int&gt; 2, 6</span></span>
<span id="cb14-10"><a href="#cb14-10" tabindex="-1"></a><span class="co">#&gt; $ total_neurology_ae_attendances &lt;int&gt; 1, 1</span></span></code></pre></div>
<p>This tells us that patients 0 and 2 are the only ones with any
neurology attendances in 2017, and is consistent with the feature table
that <code>eider</code> has calculated. However, notice that
<code>eider</code> has taken care of joining the features together and
inserting the missing value of 0 where necessary. Using
<code>eider</code> also helps to avoid errors that can easily creep in
when data is mutated in a long script.</p>
</div>
<div id="feature-3-whether-a-patient-has-ever-attended-ae" class="section level2">
<h2>Feature 3: Whether a patient has ever attended A&amp;E</h2>
<p>Through a slight modification of the first feature, we can also
calculate whether a patient has ever attended A&amp;E. This is a binary
feature, which has values of either 1 (if the patient has attended
A&amp;E) or 0 (if they have not). All we need to do is to replace the
<code>transformation_type</code> with <code>&quot;present&quot;</code> (instead of
<code>&quot;count&quot;</code>):</p>
<div class="sourceCode" id="cb15"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb15-1"><a href="#cb15-1" tabindex="-1"></a>ae_present_filepath <span class="ot">&lt;-</span> <span class="fu">eider_example</span>(<span class="st">&quot;has_visited_ae.json&quot;</span>)</span>
<span id="cb15-2"><a href="#cb15-2" tabindex="-1"></a><span class="fu">writeLines</span>(<span class="fu">readLines</span>(ae_present_filepath))</span>
<span id="cb15-3"><a href="#cb15-3" tabindex="-1"></a><span class="co">#&gt; {</span></span>
<span id="cb15-4"><a href="#cb15-4" tabindex="-1"></a><span class="co">#&gt;   &quot;source_table&quot;: &quot;ae&quot;,</span></span>
<span id="cb15-5"><a href="#cb15-5" tabindex="-1"></a><span class="co">#&gt;   &quot;transformation_type&quot;: &quot;present&quot;,</span></span>
<span id="cb15-6"><a href="#cb15-6" tabindex="-1"></a><span class="co">#&gt;   &quot;grouping_column&quot;: &quot;id&quot;,</span></span>
<span id="cb15-7"><a href="#cb15-7" tabindex="-1"></a><span class="co">#&gt;   &quot;output_feature_name&quot;: &quot;has_visited_ae&quot;</span></span>
<span id="cb15-8"><a href="#cb15-8" tabindex="-1"></a><span class="co">#&gt; }</span></span></code></pre></div>
<div class="sourceCode" id="cb16"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb16-1"><a href="#cb16-1" tabindex="-1"></a>res <span class="ot">&lt;-</span> <span class="fu">run_pipeline</span>(</span>
<span id="cb16-2"><a href="#cb16-2" tabindex="-1"></a>  <span class="at">data_sources =</span> <span class="fu">list</span>(<span class="at">ae =</span> ae_data_filepath),</span>
<span id="cb16-3"><a href="#cb16-3" tabindex="-1"></a>  <span class="at">feature_filenames =</span> ae_present_filepath</span>
<span id="cb16-4"><a href="#cb16-4" tabindex="-1"></a>)</span>
<span id="cb16-5"><a href="#cb16-5" tabindex="-1"></a></span>
<span id="cb16-6"><a href="#cb16-6" tabindex="-1"></a>dplyr<span class="sc">::</span><span class="fu">glimpse</span>(res<span class="sc">$</span>features)</span>
<span id="cb16-7"><a href="#cb16-7" tabindex="-1"></a><span class="co">#&gt; Rows: 20</span></span>
<span id="cb16-8"><a href="#cb16-8" tabindex="-1"></a><span class="co">#&gt; Columns: 2</span></span>
<span id="cb16-9"><a href="#cb16-9" tabindex="-1"></a><span class="co">#&gt; $ id             &lt;int&gt; 0, 1, 2, 3, 4, 5, 6, 7, 8, 9, 10, 11, 12, 13, 14, 15, 1…</span></span>
<span id="cb16-10"><a href="#cb16-10" tabindex="-1"></a><span class="co">#&gt; $ has_visited_ae &lt;dbl&gt; 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1…</span></span></code></pre></div>
</div>
<div id="feature-4-the-number-of-days-since-the-last-ae-attendance" class="section level2">
<h2>Feature 4: The number of days since the last A&amp;E attendance</h2>
<p>As an example of a completely different transformation type, we look
at the <code>&quot;time_since&quot;</code> feature type here. As the name
suggests, this calculates the time since an event: in this case, we
specify “from_first”: “false”<code>and</code>“cutoff_date”: “2021-03-25”
to calculate the time since the last event up to 25 March 2021; and
<code>&quot;time_units&quot;: &quot;days&quot;</code> to return the value in days. The
<code>&quot;date_column&quot;</code> specifies the name of the column in the input
table which contains the date of attendance.</p>
<p>The default value for patients who do not appear in this dataset
should, logically, be set to something large, to indicate that they have
not had a recent A&amp;E attendance. In this case we use 2000.</p>
<div class="sourceCode" id="cb17"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb17-1"><a href="#cb17-1" tabindex="-1"></a>days_since_ae_filepath <span class="ot">&lt;-</span> <span class="fu">eider_example</span>(<span class="st">&quot;days_since_last_ae.json&quot;</span>)</span>
<span id="cb17-2"><a href="#cb17-2" tabindex="-1"></a><span class="fu">writeLines</span>(<span class="fu">readLines</span>(days_since_ae_filepath))</span>
<span id="cb17-3"><a href="#cb17-3" tabindex="-1"></a><span class="co">#&gt; {</span></span>
<span id="cb17-4"><a href="#cb17-4" tabindex="-1"></a><span class="co">#&gt;   &quot;source_table&quot;: &quot;ae&quot;,</span></span>
<span id="cb17-5"><a href="#cb17-5" tabindex="-1"></a><span class="co">#&gt;   &quot;grouping_column&quot;: &quot;id&quot;,</span></span>
<span id="cb17-6"><a href="#cb17-6" tabindex="-1"></a><span class="co">#&gt;   &quot;transformation_type&quot;: &quot;time_since&quot;,</span></span>
<span id="cb17-7"><a href="#cb17-7" tabindex="-1"></a><span class="co">#&gt;   &quot;time_units&quot;: &quot;days&quot;,</span></span>
<span id="cb17-8"><a href="#cb17-8" tabindex="-1"></a><span class="co">#&gt;   &quot;from_first&quot;: false,</span></span>
<span id="cb17-9"><a href="#cb17-9" tabindex="-1"></a><span class="co">#&gt;   &quot;output_feature_name&quot;: &quot;days_since_last_ae_visit&quot;,</span></span>
<span id="cb17-10"><a href="#cb17-10" tabindex="-1"></a><span class="co">#&gt;   &quot;date_column&quot;: &quot;date&quot;,</span></span>
<span id="cb17-11"><a href="#cb17-11" tabindex="-1"></a><span class="co">#&gt;   &quot;cutoff_date&quot;: &quot;2021-03-25&quot;,</span></span>
<span id="cb17-12"><a href="#cb17-12" tabindex="-1"></a><span class="co">#&gt;   &quot;absent_default_value&quot;: 2000</span></span>
<span id="cb17-13"><a href="#cb17-13" tabindex="-1"></a><span class="co">#&gt; }</span></span></code></pre></div>
<div class="sourceCode" id="cb18"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb18-1"><a href="#cb18-1" tabindex="-1"></a>res <span class="ot">&lt;-</span> <span class="fu">run_pipeline</span>(</span>
<span id="cb18-2"><a href="#cb18-2" tabindex="-1"></a>  <span class="at">data_sources =</span> <span class="fu">list</span>(<span class="at">ae =</span> ae_data_filepath),</span>
<span id="cb18-3"><a href="#cb18-3" tabindex="-1"></a>  <span class="at">feature_filenames =</span> days_since_ae_filepath</span>
<span id="cb18-4"><a href="#cb18-4" tabindex="-1"></a>)</span>
<span id="cb18-5"><a href="#cb18-5" tabindex="-1"></a></span>
<span id="cb18-6"><a href="#cb18-6" tabindex="-1"></a>dplyr<span class="sc">::</span><span class="fu">glimpse</span>(res<span class="sc">$</span>features)</span>
<span id="cb18-7"><a href="#cb18-7" tabindex="-1"></a><span class="co">#&gt; Rows: 20</span></span>
<span id="cb18-8"><a href="#cb18-8" tabindex="-1"></a><span class="co">#&gt; Columns: 2</span></span>
<span id="cb18-9"><a href="#cb18-9" tabindex="-1"></a><span class="co">#&gt; $ id                       &lt;int&gt; 0, 1, 2, 3, 4, 5, 6, 7, 8, 9, 10, 11, 12, 13,…</span></span>
<span id="cb18-10"><a href="#cb18-10" tabindex="-1"></a><span class="co">#&gt; $ days_since_last_ae_visit &lt;dbl&gt; 1344, 1661, 1223, 1428, 1569, 1349, 1220, 125…</span></span></code></pre></div>
</div>



<!-- code folding -->


<!-- dynamically load mathjax for compatibility with self-contained -->
<script>
  (function () {
    var script = document.createElement("script");
    script.type = "text/javascript";
    script.src  = "https://mathjax.rstudio.com/latest/MathJax.js?config=TeX-AMS-MML_HTMLorMML";
    document.getElementsByTagName("head")[0].appendChild(script);
  })();
</script>

</body>
</html>
